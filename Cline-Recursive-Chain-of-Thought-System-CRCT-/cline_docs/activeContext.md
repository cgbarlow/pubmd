# Active Context

**Current Task**: Performing MUP for Web UI testing of `MarkdownService` integration. Next, will address SVG rendering in PDF or proceed with `PdfService` core implementation.

**Overall Cycle Goal**: Integrate the `@pubmd/core` package into the existing web UI.

**Last MUP Action**: This MUP cycle initiated due to successful Web UI testing of Markdown preview with core `MarkdownService` and identification of a new issue (SVGs not in PDF). Previous MUP: `MarkdownService` integration into `script.js`.

**Recent Actions & State Change**:
- **Web UI Testing of `MarkdownService` Integration**:
    - `src/web/index.html` updated with an import map to resolve bare module specifiers for `marked`, `dompurify`, and `mermaid` from CDN ESM modules.
    - Corresponding CDN `<script>` tags removed from `index.html`.
    - **Test Result**: Markdown preview (including Mermaid SVGs) in the web UI works flawlessly using the core `MarkdownService`.
    - **New Issue Identified**: While the preview is correct, Mermaid SVGs (rendered by `MarkdownService`) do *not* appear in the PDF generated by the *current local PDF generation logic* in `script.js`. Other PDF content is fine.
- `MarkdownService` from `@pubmd/core` integrated into `src/web/script.js`.
- The `@pubmd/core` package is built.
- MarkdownService implementation in core is complete.

**Current State**:
- Execution phase ongoing.
- MUP in progress for Web UI testing results.
- `@pubmd/core` `MarkdownService` successfully handles Markdown parsing and Mermaid rendering for HTML preview in the web UI.
- **Known Issue**: SVGs (specifically Mermaid diagrams) generated by `MarkdownService` are not rendering in PDFs created by the existing `html2canvas`-based logic in `script.js`.
- PDF generation and Font handling in the web UI still use local logic (not core services yet).

**Next Steps (MUP in progress)**:
- Update CRCT files (`.clinerules`, `changelog.md`, `progress.md`).
- After MUP: Prioritize addressing the SVG rendering issue in PDFs. This might involve investigating `html2canvas` limitations or planning the `PdfService` implementation in `@pubmd/core` with SVG handling in mind. The decision will be between directly tackling the SVG-in-PDF issue within the current `script.js` (if a quick fix exists for `html2canvas`) or proceeding to implement the core `PdfService` ([`Strategy_Task_CoreRefactor_PdfSvc_20250518_095954.md`](cline_docs/tasks/Strategy_Task_CoreRefactor_PdfSvc_20250518_095954.md)) which would be the more robust long-term solution.